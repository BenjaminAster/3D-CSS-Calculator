@use "sass:string";

$checkboxCount: 16;

:root {
	color-scheme: dark;
}

body {
	font-family: sans-serif;
	background-color: black;
	// font-size: 1.5rem;
	font-size: 1.5vw;
	perspective: 30em;
	// perspective: 5em;
	perspective-origin: 50% calc(50% - 2em);
	// perspective-origin: 50% 50%;
	// transform-style: preserve-3d;
	display: flex;
	align-items: center;
	justify-content: center;
	// overflow: hidden;

	* {
		transform-style: preserve-3d;
	}
}

// * {
// 	color: white;
// 	background: transparent;
// }

a {
	color: lightSkyBlue;
}

@function pow($number, $exponent) {
	$value: 1;

	@if $exponent > 0 {
		@for $i from 1 through $exponent {
			$value: $value * $number;
		}
	}

	@return $value;
}

section.addition {
	font-family: monospace;
	counter-reset: first-number second-number sum-number 0;
	user-select: none;

	.operator {
		font-weight: bold;
		font-size: 2em;
	}

	.number-display {
		font-weight: bold;
		// transform: translateY(10em) translateZ(10em) translateX(10em);
		position: absolute;
		transform: translateZ(1em);
		// transform: translate(10em, 10em, 10em);
		padding: {
			left: 0.4em;
		}
	}

	.number-display.first::after {
		content: "(" counter(first-number) ")";
	}

	.number-display.second::after {
		content: "(" counter(second-number) ")";
	}

	.number-display.sum::after {
		content: "(" counter(sum-number) ")";
	}

	input[type="checkbox"] {
		position: absolute;
		z-index: -1;
		visibility: hidden;
	}

	.labels {
		display: inline-flex;
		flex-wrap: wrap;
		gap: 1em;

		& > span {
			display: inline-block;

			width: 2em;
			height: 2em;

			label[for],
			.placeholder {
				display: inline-flex;
				align-items: center;
				justify-content: center;
				--global-transform: rotateX(calc(var(--is-one) * 90deg));

				--is-one: 0;
				padding: 1em;

				width: 2em;
				height: 2em;

				color: black;
			}

			label[for] {
				.front::before {
					content: "0";
				}
				.bottom::before {
					content: "1";
				}
			}

			.side {
				position: absolute;
				width: 2em;
				height: 2em;
				background: #{rgba(lightBlue, 60%)};
				box-shadow: 0 0 0.5em #000a inset;
				transition: transform 250ms ease-in-out;
				&::before {
					width: 100%;
					height: 100%;
					color: black;
					display: flex;
					justify-content: center;
					align-items: center;
				}
			}

			.front {
				transform: var(--global-transform) translateZ(1em);
			}
			.right {
				transform: var(--global-transform) rotateY(90deg) translateZ(1em);
			}
			.back {
				transform: var(--global-transform) rotateY(180deg) translateZ(1em);
			}
			.left {
				transform: var(--global-transform) rotateY(-90deg) translateZ(1em);
			}
			.top {
				transform: var(--global-transform) translateY(-1em) rotateX(90deg);
			}
			.bottom {
				transform: var(--global-transform) translateY(1em) rotateX(90deg) rotateZ(180deg)
					rotateY(180deg);
			}
		}
	}

	.result-display {
		--col-bg: white;
		--col-fg: black;

		display: inline-flex;
		flex-wrap: wrap;
		gap: 1em;

		& > span {
			display: inline-block;
			width: 2em;
			height: 2em;

			span.show-check {
				display: inline-flex;
				align-items: center;
				justify-content: center;

				width: 2em;
				height: 2em;
				color: black;
				padding: 1em;

				--is-one: 0;
				width: 2em;
				height: 2em;

				.side {
					position: absolute;
					width: 2em;
					height: 2em;
					background: #{rgba(lightBlue, 60%)};
					box-shadow: 0 0 0.5em #000a inset;
					--global-transform: rotateX(calc(var(--is-one) * 90deg));
					transition: transform 250ms ease-in-out;
					&::before {
						width: 100%;
						height: 100%;
						color: black;
						display: flex;
						justify-content: center;
						align-items: center;
					}
				}

				.front {
					transform: var(--global-transform) translateZ(1em);
					&::before {
						content: "0";
					}
				}
				.right {
					transform: var(--global-transform) rotateY(90deg) translateZ(1em);
				}
				.back {
					transform: var(--global-transform) rotateY(180deg) translateZ(1em);
				}
				.left {
					transform: var(--global-transform) rotateY(-90deg) translateZ(1em);
				}
				.top {
					transform: var(--global-transform) translateY(-1em) rotateX(90deg);
				}
				.bottom {
					transform: var(--global-transform) translateY(1em) rotateX(90deg) rotateZ(180deg)
						rotateY(180deg);
					&::before {
						content: "1";
					}
				}
			}
		}
	}

	@for $i from 0 through ($checkboxCount) {
		$isFirstBox: ($i == 0);
		input#check-first-#{$i} {
			@each $isFirstChecked in (true, false) {
				&#{if($isFirstChecked, ":checked", ":not(:checked)")} {
					& ~ input#check-second-#{$i} {
						@each $isSecondChecked in (true, false) {
							&#{if($isSecondChecked, ":checked", ":not(:checked)")} {
								& ~ .result-display {
									--check-#{$i}-sum: #{if(
											$isFirstBox,
											if(
												$isFirstChecked,
												if($isSecondChecked, 0, 1),
												if($isSecondChecked, 1, 0)
											),
											if(
												$isFirstChecked,
												if(
													$isSecondChecked,
													calc(var(--check-#{$i - 1}-carry)),
													calc(1 - var(--check-#{$i - 1}-carry))
												),
												if(
													$isSecondChecked,
													calc(1 - var(--check-#{$i - 1}-carry)),
													calc(var(--check-#{$i - 1}-carry))
												)
											)
										)};
									--check-#{$i}-carry: #{if(
											$isFirstBox,
											if(
												$isFirstChecked,
												if($isSecondChecked, 1, 0),
												if($isSecondChecked, 0, 0)
											),
											if(
												$isFirstChecked,
												if($isSecondChecked, 1, calc(var(--check-#{$i - 1}-carry))),
												if($isSecondChecked, calc(var(--check-#{$i - 1}-carry)), 0)
											)
										)};
								}
							}
						}
					}
				}
			}
		}

		@each $row in ("first", "second") {
			input#check-#{$row}-#{$i}:checked {
				counter-increment: #{$row}-number #{pow(2, $i)} sum-number #{pow(2, $i)};

				& ~ .#{$row}-labels {
					label[for="check-#{$row}-#{$i}"] {
						--is-one: 1;
					}
				}
			}
		}

		.result-display {
			--check-#{$checkboxCount}-sum: var(--check-#{$checkboxCount - 1}-carry);

			& > span {
				span.show-check.check-#{$i} {
					--is-one: var(--check-#{$i}-sum);
				}
			}
		}
	}
}
